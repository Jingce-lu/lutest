<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>微信 H5 兼容性坑 | Lu notes</title>
    <meta name="generator" content="VuePress 1.5.2">
    <link rel=" " href=" ">
    <meta name="description" content=" ">
    <link rel="preload" href="/lutest/assets/css/0.styles.cce74b5b.css" as="style"><link rel="preload" href="/lutest/assets/js/app.f0f4e5ba.js" as="script"><link rel="preload" href="/lutest/assets/js/2.9740266b.js" as="script"><link rel="preload" href="/lutest/assets/js/3.fe54688f.js" as="script"><link rel="preload" href="/lutest/assets/js/28.f90969f0.js" as="script"><link rel="prefetch" href="/lutest/assets/js/10.c0084733.js"><link rel="prefetch" href="/lutest/assets/js/11.ff336b65.js"><link rel="prefetch" href="/lutest/assets/js/12.07393465.js"><link rel="prefetch" href="/lutest/assets/js/13.1b627efa.js"><link rel="prefetch" href="/lutest/assets/js/14.a5bc101a.js"><link rel="prefetch" href="/lutest/assets/js/15.ef66f59a.js"><link rel="prefetch" href="/lutest/assets/js/16.a55a09ef.js"><link rel="prefetch" href="/lutest/assets/js/17.6775709b.js"><link rel="prefetch" href="/lutest/assets/js/18.0a78dd83.js"><link rel="prefetch" href="/lutest/assets/js/19.8c2ff2a8.js"><link rel="prefetch" href="/lutest/assets/js/20.9592ba28.js"><link rel="prefetch" href="/lutest/assets/js/21.28692ff4.js"><link rel="prefetch" href="/lutest/assets/js/22.fb4b712d.js"><link rel="prefetch" href="/lutest/assets/js/23.0b076270.js"><link rel="prefetch" href="/lutest/assets/js/24.6c2493c5.js"><link rel="prefetch" href="/lutest/assets/js/25.4182f127.js"><link rel="prefetch" href="/lutest/assets/js/26.78709dde.js"><link rel="prefetch" href="/lutest/assets/js/27.ab0e00d0.js"><link rel="prefetch" href="/lutest/assets/js/29.039eff68.js"><link rel="prefetch" href="/lutest/assets/js/30.5486c133.js"><link rel="prefetch" href="/lutest/assets/js/31.25b74c31.js"><link rel="prefetch" href="/lutest/assets/js/32.46b3916a.js"><link rel="prefetch" href="/lutest/assets/js/33.6aabb721.js"><link rel="prefetch" href="/lutest/assets/js/34.2ec3408c.js"><link rel="prefetch" href="/lutest/assets/js/35.4e2ba109.js"><link rel="prefetch" href="/lutest/assets/js/36.05c8ca29.js"><link rel="prefetch" href="/lutest/assets/js/37.d850614d.js"><link rel="prefetch" href="/lutest/assets/js/38.fdab2a24.js"><link rel="prefetch" href="/lutest/assets/js/39.8170e822.js"><link rel="prefetch" href="/lutest/assets/js/4.4dc286c5.js"><link rel="prefetch" href="/lutest/assets/js/40.270097a2.js"><link rel="prefetch" href="/lutest/assets/js/41.76dbc777.js"><link rel="prefetch" href="/lutest/assets/js/42.8d4531b3.js"><link rel="prefetch" href="/lutest/assets/js/43.fdce52bd.js"><link rel="prefetch" href="/lutest/assets/js/44.ecad952b.js"><link rel="prefetch" href="/lutest/assets/js/45.ce594d99.js"><link rel="prefetch" href="/lutest/assets/js/46.a62e422c.js"><link rel="prefetch" href="/lutest/assets/js/47.61d9aac4.js"><link rel="prefetch" href="/lutest/assets/js/48.c893d435.js"><link rel="prefetch" href="/lutest/assets/js/49.dfff70fb.js"><link rel="prefetch" href="/lutest/assets/js/5.c729589a.js"><link rel="prefetch" href="/lutest/assets/js/50.473844db.js"><link rel="prefetch" href="/lutest/assets/js/6.166d06bb.js"><link rel="prefetch" href="/lutest/assets/js/7.34421d12.js"><link rel="prefetch" href="/lutest/assets/js/8.ea335d0b.js"><link rel="prefetch" href="/lutest/assets/js/9.6d40df77.js">
    <link rel="stylesheet" href="/lutest/assets/css/0.styles.cce74b5b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/lutest/" class="home-link router-link-active"><!----> <span class="site-name">Lu notes</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/lutest/" class="nav-link">首页</a></div><div class="nav-item"><a href="/lutest/prepare/" class="nav-link router-link-active">Prepare</a></div><div class="nav-item"><a href="/lutest/js/" class="nav-link">Js</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/lutest/" class="nav-link">首页</a></div><div class="nav-item"><a href="/lutest/prepare/" class="nav-link router-link-active">Prepare</a></div><div class="nav-item"><a href="/lutest/js/" class="nav-link">Js</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><a href="/lutest/prepare/Collection/" class="sidebar-heading clickable"><span>Collection</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/lutest/prepare/Engineering/" class="sidebar-heading clickable"><span>Engineering</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/lutest/prepare/Mobile/" class="sidebar-heading clickable router-link-active open"><span>Mobile</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/lutest/prepare/Mobile/01-微信小程序.html" class="sidebar-link">01-微信小程序</a></li><li><a href="/lutest/prepare/Mobile/02-移动端前端适配方案.html" class="sidebar-link">02-移动端前端适配方案</a></li><li><a href="/lutest/prepare/Mobile/03-移动web资源整理.html" class="sidebar-link">03-移动web资源整理</a></li><li><a href="/lutest/prepare/Mobile/04-微信H5兼容性坑.html" class="active sidebar-link">04-微信H5兼容性坑</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/lutest/prepare/Mobile/04-微信H5兼容性坑.html#_1、ios-端兼容-input-光标高度" class="sidebar-link">1、ios 端兼容 input 光标高度</a></li><li class="sidebar-sub-header"><a href="/lutest/prepare/Mobile/04-微信H5兼容性坑.html#_2、ios-端微信-h5-页面上下滑动时卡顿、页面缺失" class="sidebar-link">2、ios 端微信 h5 页面上下滑动时卡顿、页面缺失</a></li><li class="sidebar-sub-header"><a href="/lutest/prepare/Mobile/04-微信H5兼容性坑.html#_3、ios-键盘唤起，键盘收起以后页面不归位" class="sidebar-link">3、ios 键盘唤起，键盘收起以后页面不归位</a></li><li class="sidebar-sub-header"><a href="/lutest/prepare/Mobile/04-微信H5兼容性坑.html#_4、安卓弹出的键盘遮盖文本框" class="sidebar-link">4、安卓弹出的键盘遮盖文本框</a></li><li class="sidebar-sub-header"><a href="/lutest/prepare/Mobile/04-微信H5兼容性坑.html#_5、vue-中路由使用-hash-模式，开发微信-h5-页面分享时在安卓上设置分享成功，但是-ios-的分享异常" class="sidebar-link">5、Vue 中路由使用 hash 模式，开发微信 H5 页面分享时在安卓上设置分享成功，但是 ios 的分享异常</a></li><li class="sidebar-sub-header"><a href="/lutest/prepare/Mobile/04-微信H5兼容性坑.html#题外话：" class="sidebar-link">题外话：</a></li></ul></li><li><a href="/lutest/prepare/Mobile/05-移动端的几个面试小问题.html" class="sidebar-link">05-移动端的几个面试小问题</a></li><li><a href="/lutest/prepare/Mobile/06-小程序开发中遇到的坑.html" class="sidebar-link">06-小程序开发中遇到的坑</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/lutest/prepare/Require/" class="sidebar-heading clickable"><span>Require</span> <span class="arrow right"></span></a> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="微信-h5-兼容性坑"><a href="#微信-h5-兼容性坑" class="header-anchor">#</a> 微信 H5 兼容性坑</h1> <p></p><div class="table-of-contents"><ul><li><a href="#_1、ios-端兼容-input-光标高度">1、ios 端兼容 input 光标高度</a></li><li><a href="#_2、ios-端微信-h5-页面上下滑动时卡顿、页面缺失">2、ios 端微信 h5 页面上下滑动时卡顿、页面缺失</a></li><li><a href="#_3、ios-键盘唤起，键盘收起以后页面不归位">3、ios 键盘唤起，键盘收起以后页面不归位</a></li><li><a href="#_4、安卓弹出的键盘遮盖文本框">4、安卓弹出的键盘遮盖文本框</a></li><li><a href="#_5、vue-中路由使用-hash-模式，开发微信-h5-页面分享时在安卓上设置分享成功，但是-ios-的分享异常">5、Vue 中路由使用 hash 模式，开发微信 H5 页面分享时在安卓上设置分享成功，但是 ios 的分享异常</a></li><li><a href="#题外话：">题外话：</a></li></ul></div><p></p> <h2 id="_1、ios-端兼容-input-光标高度"><a href="#_1、ios-端兼容-input-光标高度" class="header-anchor">#</a> 1、ios 端兼容 input 光标高度</h2> <p><strong>问题详情描述</strong>：input 输入框光标，在安卓手机上显示没有问题，但是在苹果手机上</p> <p>当点击输入的时候，光标的高度和父盒子的高度一样。例如下图，左图是正常所期待的输入框光标，右边是 ios 的 input 光标。</p> <div align="center"><img src="/lutest/images/prepare/mobile/2020050701.webp" alt="prepare/mobile/2020050701.webp"></div> <p><strong>出现原因分析</strong>：通常我们习惯用 height 属性设置行间的高度和 line-height 属性设置行间的距离（行高），当点击输入的时候，光标的高度就自动和父盒子的高度一样了。（谷歌浏览器的设计原则，还有一种可能就是当没有内容的时候光标的高度等于 input 的 line-height 的值，当有内容时，光标从 input 的顶端到文字的底部</p> <p><strong>解决办法</strong>：高度 height 和行高 line-height 内容用 padding 撑开</p> <p>例如：</p> <div class="language-less line-numbers-mode"><pre class="language-less"><code><span class="token selector">.content</span> <span class="token punctuation">{</span>
  <span class="token property">float</span><span class="token punctuation">:</span> left<span class="token punctuation">;</span>
  <span class="token property">box-sizing</span><span class="token punctuation">:</span> border<span class="token operator">-</span>box<span class="token punctuation">;</span>
  <span class="token property">height</span><span class="token punctuation">:</span> 88px<span class="token punctuation">;</span>
  <span class="token property">width</span><span class="token punctuation">:</span> <span class="token function">calc</span><span class="token punctuation">(</span>100% <span class="token operator">-</span> 240px<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token selector">.content-input</span> <span class="token punctuation">{</span>
    <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span>
    <span class="token property">box-sizing</span><span class="token punctuation">:</span> border<span class="token operator">-</span>box<span class="token punctuation">;</span>
    <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
    <span class="token property">color</span><span class="token punctuation">:</span> #333333<span class="token punctuation">;</span>
    <span class="token property">font-size</span><span class="token punctuation">:</span> 28px<span class="token punctuation">;</span>
    <span class="token comment">//line-height: 88px;</span>
    <span class="token property">padding-top</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span>
    <span class="token property">padding-bottom</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h2 id="_2、ios-端微信-h5-页面上下滑动时卡顿、页面缺失"><a href="#_2、ios-端微信-h5-页面上下滑动时卡顿、页面缺失" class="header-anchor">#</a> 2、ios 端微信 h5 页面上下滑动时卡顿、页面缺失</h2> <p><strong>问题详情描述</strong>：在 ios 端，上下滑动页面时，如果页面高度超出了一屏，就会出现明显的卡顿，页面有部分内容显示不全的情况，例如下图，右图是正常页面，边是 ios 上下滑动后，卡顿导致如左图下面部分丢失。</p> <div align="center"><img src="/lutest/images/prepare/mobile/2020050702.webp" alt="prepare/mobile/2020050702.webp"></div> <p><strong>出现原因分析</strong>：</p> <p>笼统说微信浏览器的内核，Android 上面是使用自带的 WebKit 内核，iOS 里面由于苹果的原因，使用了自带的 Safari 内核，Safari 对于<code>overflow-scrolling</code>用了原生控件来实现。对于有<code>-webkit-overflow-scrolling</code>的网页，会创建一个 UIScrollView，提供子 layer 给渲染模块使用。【有待考证】</p> <p><strong>解决办法</strong>：只需要在公共样式加入下面这行代码</p> <div class="language-css line-numbers-mode"><pre class="language-css"><code><span class="token selector">*</span> <span class="token punctuation">{</span>
  <span class="token property">-webkit-overflow-scrolling</span><span class="token punctuation">:</span> touch<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>But，这个属性是有 bug 的，比如如果你的页面中有设置了绝对定位的节点，那么该节点的显示会错乱，当然还有会有其他的一些 bug。</p> <p>拓展知识： -webkit-overflow-scrolling:touch 是什么？</p> <p>MDN 上是这样定义的：</p> <blockquote><p>-webkit-overflow-scrolling 属性控制元素在移动设备上是否使用滚动回弹效果.<br>
auto: 使用普通滚动, 当手指从触摸屏上移开，滚动会立即停止。<br>
touch: 使用具有回弹效果的滚动, 当手指从触摸屏上移开，内容会继续保持一段时间的滚动效果。继续滚动的速度和持续的时间和滚动手势的强烈程度成正比。同时也会创建一个新的堆栈上下文。</p></blockquote> <h2 id="_3、ios-键盘唤起，键盘收起以后页面不归位"><a href="#_3、ios-键盘唤起，键盘收起以后页面不归位" class="header-anchor">#</a> 3、ios 键盘唤起，键盘收起以后页面不归位</h2> <p><strong>问题详情描述</strong>：</p> <p>输入内容，软键盘弹出，页面内容整体上移，但是键盘收起，页面内容不下滑</p> <p><strong>出现原因分析</strong>：</p> <p>固定定位的元素 在元素内 input 框聚焦的时候 弹出的软键盘占位 失去焦点的时候软键盘消失 但是还是占位的 导致 input 框不能再次输入 在失去焦点的时候给一个事件</p> <p><strong>解决办法</strong>：</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>list-warp<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>title<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span>投·被保险人姓名<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>content<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span>
      <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>content-input<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>请输入姓名<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>peopleList.name<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">@focus</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>changefocus()<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">@blur.prevent</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>changeBlur()<span class="token punctuation">&quot;</span></span>
    <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">changeBlur</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">let</span> u <span class="token operator">=</span> navigator<span class="token punctuation">.</span>userAgent<span class="token punctuation">,</span> app <span class="token operator">=</span> navigator<span class="token punctuation">.</span>appVersion<span class="token punctuation">;</span>
  <span class="token keyword">let</span> isIOS <span class="token operator">=</span> <span class="token operator">!</span><span class="token operator">!</span>u<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex">/\(i[^;]+;( U;)? CPU.+Mac OS X/</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span><span class="token punctuation">(</span>isIOS<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> scrollHeight <span class="token operator">=</span> document<span class="token punctuation">.</span>documentElement<span class="token punctuation">.</span>scrollTop <span class="token operator">||</span>
       document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>scrollTop <span class="token operator">||</span> <span class="token number">0</span>

      window<span class="token punctuation">.</span><span class="token function">scrollTo</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>scrollHeight <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>拓展知识： <code>position: fixed</code>的元素在 ios 里，收起键盘的时候会被顶上去，特别是第三方键盘</p> <h2 id="_4、安卓弹出的键盘遮盖文本框"><a href="#_4、安卓弹出的键盘遮盖文本框" class="header-anchor">#</a> 4、安卓弹出的键盘遮盖文本框</h2> <p><strong>问题详情描述</strong>：</p> <p>安卓微信 H5 弹出软键盘后挡住 input 输入框，如下左图是期待唤起键盘的时候样子，右边是实际唤起键盘的样子</p> <div align="center"><img src="/lutest/images/prepare/mobile/2020050703.webp" alt="prepare/mobile/2020050703.webp"></div> <p>出现原因分析：待补充</p> <p><strong>解决办法</strong>：给 input 和 textarea 标签添加 focus 事件，如下，先判断是不是安卓手机下的操作，当然，可以不用判断机型，Document 对象属性和方法，setTimeout 延时 0.5 秒，因为调用安卓键盘有一点迟钝，导致如果不延时处理的话，滚动就失效了</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">changefocus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">let</span> u <span class="token operator">=</span> navigator<span class="token punctuation">.</span>userAgent<span class="token punctuation">,</span> app <span class="token operator">=</span> navigator<span class="token punctuation">.</span>appVersion<span class="token punctuation">;</span>
  <span class="token keyword">let</span> isAndroid <span class="token operator">=</span> u<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'Android'</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">||</span> u<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'Linux'</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>isAndroid<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      document<span class="token punctuation">.</span>activeElement<span class="token punctuation">.</span><span class="token function">scrollIntoViewIfNeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      document<span class="token punctuation">.</span>activeElement<span class="token punctuation">.</span><span class="token function">scrollIntoView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>拓展知识：</p> <blockquote><p><code>Element.scrollIntoView()</code>方法让当前的元素滚动到浏览器窗口的可视区域内。而<code>Element.scrollIntoViewIfNeeded()</code>方法也是用来将不在浏览器窗口的可见区域内的元素滚动到浏览器窗口的可见区域。但如果该元素已经在浏览器窗口的可见区域内，则不会发生滚动</p></blockquote> <h2 id="_5、vue-中路由使用-hash-模式，开发微信-h5-页面分享时在安卓上设置分享成功，但是-ios-的分享异常"><a href="#_5、vue-中路由使用-hash-模式，开发微信-h5-页面分享时在安卓上设置分享成功，但是-ios-的分享异常" class="header-anchor">#</a> 5、Vue 中路由使用 hash 模式，开发微信 H5 页面分享时在安卓上设置分享成功，但是 ios 的分享异常</h2> <p><strong>问题详情描述</strong>：</p> <p>ios 当前页面分享给好友，点击进来是正常，如果二次分享，则跳转到首页；使用 vue router 跳转到第二个页面后在分享时，分享设置失败；以上安卓分享都是正常</p> <div align="center"><img src="/lutest/images/prepare/mobile/2020050704.webp" alt="prepare/mobile/2020050704.webp"></div> <p><strong>出现原因分析</strong>：jssdk 是后端进行签署，前端校验，但是有时跨域，ios 是分享以后会自动带上 <code>from=singlemessage&amp;isappinstalled=0</code> 以及其他参数，分享朋友圈参数还不一样，貌似系统不一样参数也不一样，但是每次获取 url 并不能获取后面这些参数</p> <p><strong>解决办法</strong>：</p> <ol><li>可以使用改页面<code>this.$router.push</code>跳转，为<code>window.location.href</code>去跳转，而不使用路由跳转，这样可以使地址栏的地址与当前页的地址一样，可以分享成功（适合分享的页面不多的情况下，作为一个单单页运用，这样刷新页面跳转，还是..）</li> <li>把入口地址保存在本地，等需要获取签名的时候 取出来，注意：<code>sessionStorage.setItem(‘href’,href);</code> 只在刚进入单应用的时候保存！【该方法未验证】</li></ol> <h2 id="题外话："><a href="#题外话：" class="header-anchor">#</a> 题外话：</h2> <p>如果能用小程序写的页面，尽量上小程序吧，H5 开发在微信开发者工具里看页面效果可能看不出问题，因为不能唤起软键盘。避免频繁线上发布，可以用花生壳或者 idcfengye，做内网穿透，搭建一个可以通过域名访问的开发环境的 h5 页面，在手机上看看效果，对了微信内置浏览器缓存机制。会导致刚提交的代码（特别是 js）效果要半个小时左右才生效。</p> <p><strong>最后</strong>：</p> <p>微信 H5 页面其实很多知识，登陆授权，jssdk 授权，这里就只做了分享，当然还有上传图片、微信支付等功能，都可能会遇到坑，以上几个坑也是比较常遇到的，如果有更好的解决方案的话，欢迎在留言区分享。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/lutest/prepare/Mobile/03-移动web资源整理.html" class="prev">03-移动web资源整理</a></span> <span class="next"><a href="/lutest/prepare/Mobile/05-移动端的几个面试小问题.html">05-移动端的几个面试小问题</a>
      →
    </span></p></div> </main> <span data-v-2ae0ee72></span></div><div class="global-ui"></div></div>
    <script src="/lutest/assets/js/app.f0f4e5ba.js" defer></script><script src="/lutest/assets/js/2.9740266b.js" defer></script><script src="/lutest/assets/js/3.fe54688f.js" defer></script><script src="/lutest/assets/js/28.f90969f0.js" defer></script>
  </body>
</html>
