<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>实战 1：具有数据校验功能的表单组件——Form | Lu notes</title>
    <meta name="generator" content="VuePress 1.8.1">
    <link rel=" " href=" ">
    <meta name="description" content=" ">
    
    <link rel="preload" href="/lutest/assets/css/0.styles.c5cda839.css" as="style"><link rel="preload" href="/lutest/assets/js/app.ebd1d23d.js" as="script"><link rel="preload" href="/lutest/assets/js/3.6f79f3df.js" as="script"><link rel="preload" href="/lutest/assets/js/4.2436b720.js" as="script"><link rel="preload" href="/lutest/assets/js/53.89d7490c.js" as="script"><link rel="prefetch" href="/lutest/assets/js/1.1cc44110.js"><link rel="prefetch" href="/lutest/assets/js/10.2ff953e2.js"><link rel="prefetch" href="/lutest/assets/js/100.d21da0b1.js"><link rel="prefetch" href="/lutest/assets/js/101.baee6874.js"><link rel="prefetch" href="/lutest/assets/js/102.a131df4d.js"><link rel="prefetch" href="/lutest/assets/js/103.bc2d83c4.js"><link rel="prefetch" href="/lutest/assets/js/104.55aba83c.js"><link rel="prefetch" href="/lutest/assets/js/105.34f83aee.js"><link rel="prefetch" href="/lutest/assets/js/106.f9b9a8dd.js"><link rel="prefetch" href="/lutest/assets/js/107.fb75706f.js"><link rel="prefetch" href="/lutest/assets/js/108.8162cb52.js"><link rel="prefetch" href="/lutest/assets/js/109.335aec84.js"><link rel="prefetch" href="/lutest/assets/js/11.be8389d9.js"><link rel="prefetch" href="/lutest/assets/js/110.6783d72e.js"><link rel="prefetch" href="/lutest/assets/js/111.32296bb2.js"><link rel="prefetch" href="/lutest/assets/js/112.f605d6b5.js"><link rel="prefetch" href="/lutest/assets/js/113.9dfc15c2.js"><link rel="prefetch" href="/lutest/assets/js/114.c2dd4c1c.js"><link rel="prefetch" href="/lutest/assets/js/115.8961136d.js"><link rel="prefetch" href="/lutest/assets/js/116.4b9a4b76.js"><link rel="prefetch" href="/lutest/assets/js/117.4a60375f.js"><link rel="prefetch" href="/lutest/assets/js/118.313841c7.js"><link rel="prefetch" href="/lutest/assets/js/119.cba1f6de.js"><link rel="prefetch" href="/lutest/assets/js/12.ffe23520.js"><link rel="prefetch" href="/lutest/assets/js/120.07a8f28b.js"><link rel="prefetch" href="/lutest/assets/js/121.e5a6dee9.js"><link rel="prefetch" href="/lutest/assets/js/122.04b20843.js"><link rel="prefetch" href="/lutest/assets/js/123.20b5817c.js"><link rel="prefetch" href="/lutest/assets/js/124.4e3bc7c0.js"><link rel="prefetch" href="/lutest/assets/js/125.ba63819b.js"><link rel="prefetch" href="/lutest/assets/js/126.9eb167aa.js"><link rel="prefetch" href="/lutest/assets/js/127.78d35f1e.js"><link rel="prefetch" href="/lutest/assets/js/128.f814450d.js"><link rel="prefetch" href="/lutest/assets/js/129.9fa697d6.js"><link rel="prefetch" href="/lutest/assets/js/13.767ad5e3.js"><link rel="prefetch" href="/lutest/assets/js/130.255283ff.js"><link rel="prefetch" href="/lutest/assets/js/131.e0065cd8.js"><link rel="prefetch" href="/lutest/assets/js/132.04ec8e1a.js"><link rel="prefetch" href="/lutest/assets/js/133.e920aac4.js"><link rel="prefetch" href="/lutest/assets/js/134.82b32064.js"><link rel="prefetch" href="/lutest/assets/js/135.d6b4975f.js"><link rel="prefetch" href="/lutest/assets/js/136.03fcaba8.js"><link rel="prefetch" href="/lutest/assets/js/137.a666b1a1.js"><link rel="prefetch" href="/lutest/assets/js/138.b842e61b.js"><link rel="prefetch" href="/lutest/assets/js/139.a2ad3760.js"><link rel="prefetch" href="/lutest/assets/js/14.c7f80a25.js"><link rel="prefetch" href="/lutest/assets/js/140.13d6ab3e.js"><link rel="prefetch" href="/lutest/assets/js/141.e6c566c5.js"><link rel="prefetch" href="/lutest/assets/js/142.58403d16.js"><link rel="prefetch" href="/lutest/assets/js/143.7521ee07.js"><link rel="prefetch" href="/lutest/assets/js/144.661c7349.js"><link rel="prefetch" href="/lutest/assets/js/145.982663fe.js"><link rel="prefetch" href="/lutest/assets/js/146.a44e9e61.js"><link rel="prefetch" href="/lutest/assets/js/147.2e9e5807.js"><link rel="prefetch" href="/lutest/assets/js/148.ac533762.js"><link rel="prefetch" href="/lutest/assets/js/149.1e08e983.js"><link rel="prefetch" href="/lutest/assets/js/15.fc7b9ab4.js"><link rel="prefetch" href="/lutest/assets/js/150.95d28dc6.js"><link rel="prefetch" href="/lutest/assets/js/151.56785bd1.js"><link rel="prefetch" href="/lutest/assets/js/152.3a3f24cd.js"><link rel="prefetch" href="/lutest/assets/js/153.807c7e0e.js"><link rel="prefetch" href="/lutest/assets/js/154.215e894d.js"><link rel="prefetch" href="/lutest/assets/js/155.de48c699.js"><link rel="prefetch" href="/lutest/assets/js/156.5ce189fd.js"><link rel="prefetch" href="/lutest/assets/js/157.0056b854.js"><link rel="prefetch" href="/lutest/assets/js/158.38c42e6b.js"><link rel="prefetch" href="/lutest/assets/js/159.9da47ebe.js"><link rel="prefetch" href="/lutest/assets/js/16.5fb031f0.js"><link rel="prefetch" href="/lutest/assets/js/160.0ede62a7.js"><link rel="prefetch" href="/lutest/assets/js/161.22043583.js"><link rel="prefetch" href="/lutest/assets/js/162.2932e118.js"><link rel="prefetch" href="/lutest/assets/js/163.3ee0dc6b.js"><link rel="prefetch" href="/lutest/assets/js/164.53d9bd26.js"><link rel="prefetch" href="/lutest/assets/js/165.4743e1b8.js"><link rel="prefetch" href="/lutest/assets/js/166.03917770.js"><link rel="prefetch" href="/lutest/assets/js/167.ab40a424.js"><link rel="prefetch" href="/lutest/assets/js/168.2dd2dc95.js"><link rel="prefetch" href="/lutest/assets/js/169.639a09a0.js"><link rel="prefetch" href="/lutest/assets/js/17.f146ab28.js"><link rel="prefetch" href="/lutest/assets/js/170.9330021e.js"><link rel="prefetch" href="/lutest/assets/js/171.12b45f30.js"><link rel="prefetch" href="/lutest/assets/js/172.4f439cac.js"><link rel="prefetch" href="/lutest/assets/js/173.cea1208f.js"><link rel="prefetch" href="/lutest/assets/js/174.44fdd364.js"><link rel="prefetch" href="/lutest/assets/js/175.c56b9a9d.js"><link rel="prefetch" href="/lutest/assets/js/176.6cba9443.js"><link rel="prefetch" href="/lutest/assets/js/177.51f7a624.js"><link rel="prefetch" href="/lutest/assets/js/178.6724f835.js"><link rel="prefetch" href="/lutest/assets/js/179.55060edc.js"><link rel="prefetch" href="/lutest/assets/js/18.2eb2e3bb.js"><link rel="prefetch" href="/lutest/assets/js/180.5c6aa03d.js"><link rel="prefetch" href="/lutest/assets/js/181.bfd11266.js"><link rel="prefetch" href="/lutest/assets/js/182.5c98cc60.js"><link rel="prefetch" href="/lutest/assets/js/183.531c3a75.js"><link rel="prefetch" href="/lutest/assets/js/184.ba313711.js"><link rel="prefetch" href="/lutest/assets/js/185.9f2ccd41.js"><link rel="prefetch" href="/lutest/assets/js/186.e3cf7ab6.js"><link rel="prefetch" href="/lutest/assets/js/187.2bd9c39b.js"><link rel="prefetch" href="/lutest/assets/js/188.5efe56c2.js"><link rel="prefetch" href="/lutest/assets/js/189.6c617798.js"><link rel="prefetch" href="/lutest/assets/js/19.93766500.js"><link rel="prefetch" href="/lutest/assets/js/190.95bac022.js"><link rel="prefetch" href="/lutest/assets/js/191.935efb12.js"><link rel="prefetch" href="/lutest/assets/js/192.5d7b01bf.js"><link rel="prefetch" href="/lutest/assets/js/193.4e0712de.js"><link rel="prefetch" href="/lutest/assets/js/194.a2d6490d.js"><link rel="prefetch" href="/lutest/assets/js/195.d3c682e9.js"><link rel="prefetch" href="/lutest/assets/js/196.bed64a26.js"><link rel="prefetch" href="/lutest/assets/js/197.95905734.js"><link rel="prefetch" href="/lutest/assets/js/198.9cf78938.js"><link rel="prefetch" href="/lutest/assets/js/199.22196020.js"><link rel="prefetch" href="/lutest/assets/js/20.db0a8ddb.js"><link rel="prefetch" href="/lutest/assets/js/200.89f273be.js"><link rel="prefetch" href="/lutest/assets/js/201.93d3f6fe.js"><link rel="prefetch" href="/lutest/assets/js/202.45b06b33.js"><link rel="prefetch" href="/lutest/assets/js/203.93ec4e0c.js"><link rel="prefetch" href="/lutest/assets/js/204.c3bd1cd6.js"><link rel="prefetch" href="/lutest/assets/js/205.118fb21c.js"><link rel="prefetch" href="/lutest/assets/js/206.c0170849.js"><link rel="prefetch" href="/lutest/assets/js/207.5d1f15b7.js"><link rel="prefetch" href="/lutest/assets/js/208.8e7bf216.js"><link rel="prefetch" href="/lutest/assets/js/209.c7ea67d4.js"><link rel="prefetch" href="/lutest/assets/js/21.9f255a67.js"><link rel="prefetch" href="/lutest/assets/js/210.c4ee63e6.js"><link rel="prefetch" href="/lutest/assets/js/211.a33d4a8a.js"><link rel="prefetch" href="/lutest/assets/js/212.593ace03.js"><link rel="prefetch" href="/lutest/assets/js/213.9e519031.js"><link rel="prefetch" href="/lutest/assets/js/214.fff03cb4.js"><link rel="prefetch" href="/lutest/assets/js/215.4370c0b4.js"><link rel="prefetch" href="/lutest/assets/js/216.41a18deb.js"><link rel="prefetch" href="/lutest/assets/js/217.ac80eab5.js"><link rel="prefetch" href="/lutest/assets/js/218.b7e21ca7.js"><link rel="prefetch" href="/lutest/assets/js/219.36ab4a6d.js"><link rel="prefetch" href="/lutest/assets/js/22.61118860.js"><link rel="prefetch" href="/lutest/assets/js/220.20a87e13.js"><link rel="prefetch" href="/lutest/assets/js/221.4f6cf5e4.js"><link rel="prefetch" href="/lutest/assets/js/222.d8c10255.js"><link rel="prefetch" href="/lutest/assets/js/223.9dadcc71.js"><link rel="prefetch" href="/lutest/assets/js/224.abc70a85.js"><link rel="prefetch" href="/lutest/assets/js/225.630efeec.js"><link rel="prefetch" href="/lutest/assets/js/226.6a16013f.js"><link rel="prefetch" href="/lutest/assets/js/227.54ac477a.js"><link rel="prefetch" href="/lutest/assets/js/228.0613864d.js"><link rel="prefetch" href="/lutest/assets/js/229.b46c0bb4.js"><link rel="prefetch" href="/lutest/assets/js/23.4801e669.js"><link rel="prefetch" href="/lutest/assets/js/230.99851e7c.js"><link rel="prefetch" href="/lutest/assets/js/231.0cb758cd.js"><link rel="prefetch" href="/lutest/assets/js/232.c75c975c.js"><link rel="prefetch" href="/lutest/assets/js/233.58e102cc.js"><link rel="prefetch" href="/lutest/assets/js/234.6e621cca.js"><link rel="prefetch" href="/lutest/assets/js/235.af91ffe1.js"><link rel="prefetch" href="/lutest/assets/js/236.aa7b5bb4.js"><link rel="prefetch" href="/lutest/assets/js/237.9759562f.js"><link rel="prefetch" href="/lutest/assets/js/238.ddcbb846.js"><link rel="prefetch" href="/lutest/assets/js/239.f6fedf2e.js"><link rel="prefetch" href="/lutest/assets/js/24.d9f96d86.js"><link rel="prefetch" href="/lutest/assets/js/240.89bad7ce.js"><link rel="prefetch" href="/lutest/assets/js/241.2bb2e533.js"><link rel="prefetch" href="/lutest/assets/js/242.2facd362.js"><link rel="prefetch" href="/lutest/assets/js/243.4273a51b.js"><link rel="prefetch" href="/lutest/assets/js/244.e1a79f41.js"><link rel="prefetch" href="/lutest/assets/js/245.7047db19.js"><link rel="prefetch" href="/lutest/assets/js/246.0bcbfd13.js"><link rel="prefetch" href="/lutest/assets/js/247.761c3d12.js"><link rel="prefetch" href="/lutest/assets/js/248.564d92cd.js"><link rel="prefetch" href="/lutest/assets/js/249.8bfbc3bc.js"><link rel="prefetch" href="/lutest/assets/js/25.38ffa021.js"><link rel="prefetch" href="/lutest/assets/js/250.9db83fa0.js"><link rel="prefetch" href="/lutest/assets/js/251.9e29cd98.js"><link rel="prefetch" href="/lutest/assets/js/252.46232f04.js"><link rel="prefetch" href="/lutest/assets/js/253.12665a80.js"><link rel="prefetch" href="/lutest/assets/js/254.bc763e10.js"><link rel="prefetch" href="/lutest/assets/js/255.51e2fceb.js"><link rel="prefetch" href="/lutest/assets/js/26.61eedfc1.js"><link rel="prefetch" href="/lutest/assets/js/27.262b1e42.js"><link rel="prefetch" href="/lutest/assets/js/28.c05c6191.js"><link rel="prefetch" href="/lutest/assets/js/29.1fd3ab2f.js"><link rel="prefetch" href="/lutest/assets/js/30.7fc64696.js"><link rel="prefetch" href="/lutest/assets/js/31.c05bd128.js"><link rel="prefetch" href="/lutest/assets/js/32.fa2080ce.js"><link rel="prefetch" href="/lutest/assets/js/33.90ad4444.js"><link rel="prefetch" href="/lutest/assets/js/34.f41c9b50.js"><link rel="prefetch" href="/lutest/assets/js/35.6c0645c2.js"><link rel="prefetch" href="/lutest/assets/js/36.42d6b1ba.js"><link rel="prefetch" href="/lutest/assets/js/37.94975372.js"><link rel="prefetch" href="/lutest/assets/js/38.9e05f896.js"><link rel="prefetch" href="/lutest/assets/js/39.b2e33d4f.js"><link rel="prefetch" href="/lutest/assets/js/40.b558ff04.js"><link rel="prefetch" href="/lutest/assets/js/41.7fc54cb5.js"><link rel="prefetch" href="/lutest/assets/js/42.77674c59.js"><link rel="prefetch" href="/lutest/assets/js/43.85dac72d.js"><link rel="prefetch" href="/lutest/assets/js/44.4755ac46.js"><link rel="prefetch" href="/lutest/assets/js/45.e5faa52c.js"><link rel="prefetch" href="/lutest/assets/js/46.a0bfd437.js"><link rel="prefetch" href="/lutest/assets/js/47.3b05e92d.js"><link rel="prefetch" href="/lutest/assets/js/48.19c61a76.js"><link rel="prefetch" href="/lutest/assets/js/49.dba95b21.js"><link rel="prefetch" href="/lutest/assets/js/5.6f57952d.js"><link rel="prefetch" href="/lutest/assets/js/50.ec1c8db4.js"><link rel="prefetch" href="/lutest/assets/js/51.279c48ec.js"><link rel="prefetch" href="/lutest/assets/js/52.50004cc9.js"><link rel="prefetch" href="/lutest/assets/js/54.7c9601ca.js"><link rel="prefetch" href="/lutest/assets/js/55.5da8ea72.js"><link rel="prefetch" href="/lutest/assets/js/56.3ddd5b57.js"><link rel="prefetch" href="/lutest/assets/js/57.4581a13f.js"><link rel="prefetch" href="/lutest/assets/js/58.32fefc1d.js"><link rel="prefetch" href="/lutest/assets/js/59.9e85ab43.js"><link rel="prefetch" href="/lutest/assets/js/6.b2c8eec7.js"><link rel="prefetch" href="/lutest/assets/js/60.64ab3593.js"><link rel="prefetch" href="/lutest/assets/js/61.d6a37605.js"><link rel="prefetch" href="/lutest/assets/js/62.381f6b44.js"><link rel="prefetch" href="/lutest/assets/js/63.fa58f38a.js"><link rel="prefetch" href="/lutest/assets/js/64.35fd9833.js"><link rel="prefetch" href="/lutest/assets/js/65.80555155.js"><link rel="prefetch" href="/lutest/assets/js/66.df6969ed.js"><link rel="prefetch" href="/lutest/assets/js/67.654d2c26.js"><link rel="prefetch" href="/lutest/assets/js/68.5fba8f43.js"><link rel="prefetch" href="/lutest/assets/js/69.88f51af3.js"><link rel="prefetch" href="/lutest/assets/js/7.04fc8669.js"><link rel="prefetch" href="/lutest/assets/js/70.d83d484b.js"><link rel="prefetch" href="/lutest/assets/js/71.52619ce8.js"><link rel="prefetch" href="/lutest/assets/js/72.38de7dbb.js"><link rel="prefetch" href="/lutest/assets/js/73.46d7b578.js"><link rel="prefetch" href="/lutest/assets/js/74.01cdf0a0.js"><link rel="prefetch" href="/lutest/assets/js/75.3f5c6723.js"><link rel="prefetch" href="/lutest/assets/js/76.1290445f.js"><link rel="prefetch" href="/lutest/assets/js/77.430ba314.js"><link rel="prefetch" href="/lutest/assets/js/78.5067d307.js"><link rel="prefetch" href="/lutest/assets/js/79.40e4e726.js"><link rel="prefetch" href="/lutest/assets/js/8.0b55fcd3.js"><link rel="prefetch" href="/lutest/assets/js/80.85afcd52.js"><link rel="prefetch" href="/lutest/assets/js/81.8e3a8854.js"><link rel="prefetch" href="/lutest/assets/js/82.8e763542.js"><link rel="prefetch" href="/lutest/assets/js/83.cfa7c44e.js"><link rel="prefetch" href="/lutest/assets/js/84.c63d37be.js"><link rel="prefetch" href="/lutest/assets/js/85.2779b01b.js"><link rel="prefetch" href="/lutest/assets/js/86.70e47826.js"><link rel="prefetch" href="/lutest/assets/js/87.8f1c4b6a.js"><link rel="prefetch" href="/lutest/assets/js/88.9b8a4114.js"><link rel="prefetch" href="/lutest/assets/js/89.562f3169.js"><link rel="prefetch" href="/lutest/assets/js/9.816e031f.js"><link rel="prefetch" href="/lutest/assets/js/90.deeae8d3.js"><link rel="prefetch" href="/lutest/assets/js/91.8c614725.js"><link rel="prefetch" href="/lutest/assets/js/92.570ebf03.js"><link rel="prefetch" href="/lutest/assets/js/93.4bd3d05f.js"><link rel="prefetch" href="/lutest/assets/js/94.286929df.js"><link rel="prefetch" href="/lutest/assets/js/95.18018c8f.js"><link rel="prefetch" href="/lutest/assets/js/96.8e645ebe.js"><link rel="prefetch" href="/lutest/assets/js/97.e6959e6f.js"><link rel="prefetch" href="/lutest/assets/js/98.46bbc6d3.js"><link rel="prefetch" href="/lutest/assets/js/99.4d53c140.js">
    <link rel="stylesheet" href="/lutest/assets/css/0.styles.c5cda839.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/lutest/" class="home-link router-link-active"><!----> <span class="site-name">Lu notes</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/lutest/" class="nav-link">首页</a></div><div class="nav-item"><a href="/lutest/prepare/" class="nav-link">Prepare</a></div><div class="nav-item"><a href="/lutest/js/" class="nav-link">Js</a></div><div class="nav-item"><a href="/lutest/collection/" class="nav-link">Collection</a></div><div class="nav-item"><a href="/lutest/study2020/" class="nav-link">study2020</a></div><div class="nav-item"><a href="/lutest/brochure/" class="nav-link router-link-active">技术小册</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/lutest/" class="nav-link">首页</a></div><div class="nav-item"><a href="/lutest/prepare/" class="nav-link">Prepare</a></div><div class="nav-item"><a href="/lutest/js/" class="nav-link">Js</a></div><div class="nav-item"><a href="/lutest/collection/" class="nav-link">Collection</a></div><div class="nav-item"><a href="/lutest/study2020/" class="nav-link">study2020</a></div><div class="nav-item"><a href="/lutest/brochure/" class="nav-link router-link-active">技术小册</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><a href="/lutest/brochure/React：设计模式和最佳实践/" class="sidebar-heading clickable"><span>React：设计模式和最佳实践</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/lutest/brochure/Vue.js组件精讲/" class="sidebar-heading clickable open"><span>Vue.js组件精讲</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/lutest/brochure/Vue.js组件精讲/01-开篇：Vue.js的精髓——组件.html" class="sidebar-link">01-开篇：Vue.js的精髓——组件</a></li><li><a href="/lutest/brochure/Vue.js组件精讲/02-基础：Vue.js组件的三个API：prop、event、slot.html" class="sidebar-link">02-基础：Vue.js组件的三个API：prop、event、slot</a></li><li><a href="/lutest/brochure/Vue.js组件精讲/03-组件的通信1：provide-inject.html" class="sidebar-link">03-组件的通信1：provide-inject</a></li><li><a href="/lutest/brochure/Vue.js组件精讲/04-组件的通信2：派发与广播——自行实现dispatch和broadcast方法.html" class="sidebar-link">04-组件的通信2：派发与广播——自行实现dispatch和broadcast方法</a></li><li><a href="/lutest/brochure/Vue.js组件精讲/05-实战1：具有数据校验功能的表单组件——Form.html" class="active sidebar-link">05-实战1：具有数据校验功能的表单组件——Form</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/lutest/brochure/Vue.js组件精讲/05-实战1：具有数据校验功能的表单组件——Form.html#接口设计" class="sidebar-link">接口设计</a></li><li class="sidebar-sub-header"><a href="/lutest/brochure/Vue.js组件精讲/05-实战1：具有数据校验功能的表单组件——Form.html#在-form-中缓存-formitem-实例" class="sidebar-link">在 Form 中缓存 FormItem 实例</a></li><li class="sidebar-sub-header"><a href="/lutest/brochure/Vue.js组件精讲/05-实战1：具有数据校验功能的表单组件——Form.html#触发校验" class="sidebar-link">触发校验</a></li></ul></li><li><a href="/lutest/brochure/Vue.js组件精讲/06-组件的通信3：找到任意组件实例——findComponents系列方法.html" class="sidebar-link">06-组件的通信3：找到任意组件实例——findComponents系列方法</a></li><li><a href="/lutest/brochure/Vue.js组件精讲/07-实战2：组合多选框组件——CheckboxGroup&amp;Checkbox.html" class="sidebar-link">07-实战2：组合多选框组件——CheckboxGroup&amp;Checkbox</a></li><li><a href="/lutest/brochure/Vue.js组件精讲/08-Vue的构造器——extend与手动挂载——mount.html" class="sidebar-link">08-Vue的构造器——extend与手动挂载——mount</a></li><li><a href="/lutest/brochure/Vue.js组件精讲/09-实战3：动态渲染.vue文件的组件——Display.html" class="sidebar-link">09-实战3：动态渲染.vue文件的组件——Display</a></li><li><a href="/lutest/brochure/Vue.js组件精讲/10-实战4：全局提示组件——Alert.html" class="sidebar-link">10-实战4：全局提示组件——Alert</a></li><li><a href="/lutest/brochure/Vue.js组件精讲/11-更灵活的组件：Render函数与Functional-Render.html" class="sidebar-link">11-更灵活的组件：Render函数与Functional-Render</a></li><li><a href="/lutest/brochure/Vue.js组件精讲/12-实战5：可用Render自定义列的表格组件——Table.html" class="sidebar-link">12-实战5：可用Render自定义列的表格组件——Table</a></li><li><a href="/lutest/brochure/Vue.js组件精讲/13-实战6：可用slot-scope自定义列的表格组件——Table.html" class="sidebar-link">13-实战6：可用slot-scope自定义列的表格组件——Table</a></li><li><a href="/lutest/brochure/Vue.js组件精讲/14-递归组件与动态组件.html" class="sidebar-link">14-递归组件与动态组件</a></li><li><a href="/lutest/brochure/Vue.js组件精讲/15-实战7：树形控件——Tree.html" class="sidebar-link">15-实战7：树形控件——Tree</a></li><li><a href="/lutest/brochure/Vue.js组件精讲/16-拓展：Vue.js容易忽略的API详解.html" class="sidebar-link">16-拓展：Vue.js容易忽略的API详解</a></li><li><a href="/lutest/brochure/Vue.js组件精讲/17-拓展：Vue.js面试、常见问题答疑.html" class="sidebar-link">17-拓展：Vue.js面试、常见问题答疑</a></li><li><a href="/lutest/brochure/Vue.js组件精讲/18-拓展：如何做好一个开源项目（上篇）.html" class="sidebar-link">18-拓展：如何做好一个开源项目（上篇）</a></li><li><a href="/lutest/brochure/Vue.js组件精讲/19-拓展：如何做好一个开源项目（下篇）.html" class="sidebar-link">19-拓展：如何做好一个开源项目（下篇）</a></li><li><a href="/lutest/brochure/Vue.js组件精讲/20-写在最后.html" class="sidebar-link">20-写在最后</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/lutest/brochure/Vue3.0前瞻/" class="sidebar-heading clickable"><span>Vue3.0前瞻</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/lutest/brochure/中高级前端必备知识/" class="sidebar-heading clickable"><span>中高级前端必备知识</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/lutest/brochure/前端性能优化原理与实践/" class="sidebar-heading clickable"><span>前端性能优化原理与实践</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/lutest/brochure/源码分析/" class="sidebar-heading clickable"><span>源码分析</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/lutest/brochure/趣谈Linux/" class="sidebar-heading clickable"><span>趣谈Linux</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/lutest/brochure/重学前端/" class="sidebar-heading clickable"><span>重学前端</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/lutest/brochure/零基础学透TypeScript/" class="sidebar-heading clickable"><span>零基础学透TypeScript</span> <span class="arrow right"></span></a> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="实战-1-具有数据校验功能的表单组件-form"><a href="#实战-1-具有数据校验功能的表单组件-form" class="header-anchor">#</a> 实战 1：具有数据校验功能的表单组件——Form</h1> <p>在第 3 节和第 4 节中，我们介绍了组件间的两种通信方法：provide / inject 和 dispatch / broadcast，前者是 Vue.js 内置的，主要用于子组件获取父组件（包括跨级）的状态；后者是自行实现的一种混合，用于父子组件（包括跨级）间通过自定义事件通信。本小节则基于这两种通信方法，来实现一个具有数据校验功能的表单组件——Form。</p> <h3 id="form-组件概览"><a href="#form-组件概览" class="header-anchor">#</a> Form 组件概览</h3> <hr> <p>表单类组件在项目中会大量使用，比如输入框（Input）、单选（Radio）、多选（Checkbox）、下拉选择器（Select）等。在使用表单类组件时，也会经常用到数据校验，如果每次都写校验程序来对每一个表单控件校验，会很低效，因此需要一个能够校验基础表单控件的组件，也就是本节要完成的 Form 组件。一般的组件库都提供了这个组件，比如 iView，它能够校验内置的 15 种控件，且支持校验自定义组件，如下图所示：</p> <p>（也可以在线访问本示例体验：<a href="https://run.iviewui.com/jwrqnFss" target="_blank" rel="noopener noreferrer">run.iviewui.com/jwrqnFss<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>）
<img src="https://img1.yixinfinance.com/wiki/images/166c3b75c37ef9a8" alt=""></p> <p>Form 组件分为两个部分，一个是外层的 <code>Form</code> 表单域组件，一组表单控件只有一个 Form，而内部包含了多个 <code>FormItem</code> 组件，每一个表单控件都被一个 FormItem 包裹。基本的结构看起来像：</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i-form</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i-form-item</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i-input</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>form.name<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i-input</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i-form-item</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i-form-item</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i-input</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>form.mail<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i-input</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i-form-item</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i-form</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>Form 要用到数据校验，并在对应的 FormItem 中给出校验失败的提示，校验我们会用到一个开源库：<a href="https://github.com/yiminghe/async-validator" target="_blank" rel="noopener noreferrer">async-validator<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，基本主流的组件库都是基于它做的校验。使用它很简单，只需按要求写好一个校验规则就好，比如：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">[</span>
  <span class="token punctuation">{</span> required<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> message<span class="token operator">:</span> <span class="token string">'邮箱不能为空'</span><span class="token punctuation">,</span> trigger<span class="token operator">:</span> <span class="token string">'blur'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'email'</span><span class="token punctuation">,</span> message<span class="token operator">:</span> <span class="token string">'邮箱格式不正确'</span><span class="token punctuation">,</span> trigger<span class="token operator">:</span> <span class="token string">'blur'</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>这个代表要校验的数据先判断是否为空（required: true），如果为空，则提示“邮箱不能为空”，触发校验的事件为失焦（trigger: 'blur'），如果第一条满足要求，再进行第二条的验证，判断是否为邮箱格式（type: 'email'）等等，还支持自定义校验规则。更详细的用法可以参看它的文档。</p> <h2 id="接口设计"><a href="#接口设计" class="header-anchor">#</a> 接口设计</h2> <p>我们先使用最新的 Vue CLI 3 创建一个空白的项目（如果你还不清楚 Vue CLI 3 的用法，需要先补习一下了，可以阅读文末的扩展阅读 1），并使用 <code>vue-router</code> 插件，同时安装好 <code>async-validator</code> 库。</p> <p>在 <code>src/components</code> 下新建一个 <code>form</code> 文件夹，并初始化两个组件 <code>form.vue</code> 和 <code>form-item.vue</code>，然后初始化项目，配置路由，创建一个页面能够被访问到。</p> <blockquote><p>本节所有代码可以在 <a href="https://github.com/icarusion/vue-component-book" target="_blank" rel="noopener noreferrer">github.com/icarusion/v…<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 中查看，你可以一边看源码，一边阅读本节；也可以边阅读，边动手实现一遍，遇到问题再参考完整的源码。</p></blockquote> <p>第 2 节我们介绍到，编写一个 Vue.js 组件，最重要的是设计好它的接口，一个 Vue.js 组件的接口来自三个部分：props、slots、events。而 Form 和 FormItem 两个组件主要做数据校验，用不到 events。Form 的 slot 就是一系列的 FormItem，FormItem 的 slot 就是具体的表单控件，比如输入框 <code>&lt;i-input&gt;</code> 。那主要设计的就是 props 了。</p> <p>在 <code>Form</code> 组件中，定义两个 props：</p> <ul><li>model：表单控件绑定的数据对象，在校验或重置时会访问该数据对象下对应的表单数据，类型为 Object。</li> <li>rules：表单验证规则，即上面介绍的 async-validator 所使用的校验规则，类型为 Object。</li></ul> <p>在 <code>FormItem</code> 组件中，也定义两个 props：</p> <ul><li>label：单个表单组件的标签文本，类似原生的 <code>&lt;label&gt;</code> 元素，类型为 String。</li> <li>prop：对应表单域 Form 组件 model 里的字段，用于在校验或重置时访问表单组件绑定的数据，类型为 String。</li></ul> <p>定义好 props，就可以写出大概的用例了：</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i-form</span> <span class="token attr-name">:model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>formValidate<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:rules</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ruleValidate<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i-form-item</span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>用户名<span class="token punctuation">&quot;</span></span> <span class="token attr-name">prop</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>name<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i-input</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>formValidate.name<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i-input</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i-form-item</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i-form-item</span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>邮箱<span class="token punctuation">&quot;</span></span> <span class="token attr-name">prop</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mail<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i-input</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>formValidate.mail<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i-input</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i-form-item</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i-form</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">import</span> iForm <span class="token keyword">from</span> <span class="token string">'../components/form/form.vue'</span><span class="token punctuation">;</span>
  <span class="token keyword">import</span> iFormItem <span class="token keyword">from</span> <span class="token string">'../components/form/form-item.vue'</span><span class="token punctuation">;</span>
  <span class="token keyword">import</span> iInput <span class="token keyword">from</span> <span class="token string">'../components/input/input.vue'</span><span class="token punctuation">;</span>

  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    components<span class="token operator">:</span> <span class="token punctuation">{</span> iForm<span class="token punctuation">,</span> iFormItem<span class="token punctuation">,</span> iInput <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">data</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        formValidate<span class="token operator">:</span> <span class="token punctuation">{</span>
          name<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
          mail<span class="token operator">:</span> <span class="token string">''</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        ruleValidate<span class="token operator">:</span> <span class="token punctuation">{</span>
          name<span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span> required<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> message<span class="token operator">:</span> <span class="token string">'用户名不能为空'</span><span class="token punctuation">,</span> trigger<span class="token operator">:</span> <span class="token string">'blur'</span> <span class="token punctuation">}</span>
          <span class="token punctuation">]</span><span class="token punctuation">,</span>
          mail<span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span> required<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> message<span class="token operator">:</span> <span class="token string">'邮箱不能为空'</span><span class="token punctuation">,</span> trigger<span class="token operator">:</span> <span class="token string">'blur'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'email'</span><span class="token punctuation">,</span> message<span class="token operator">:</span> <span class="token string">'邮箱格式不正确'</span><span class="token punctuation">,</span> trigger<span class="token operator">:</span> <span class="token string">'blur'</span> <span class="token punctuation">}</span>
          <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><p>有两点需要注意的是：</p> <ol><li>这里的 <code>&lt;i-input&gt;</code> 并不是原生的 <code>&lt;input&gt;</code> 输入框，而是一个特制的输入框组件，之后会介讲解的功能和代码；</li> <li><code>&lt;i-form-item&gt;</code> 的属性 <code>prop</code> 是字符串，所以它前面没有冒号（即不是 <code>:prop=&quot;name&quot;</code>）。</li> <li></li></ol> <p>当前的两个组件只是个框框，还没有实现任何功能，不过万事开头难，定义好接口，剩下的就是补全组件的逻辑，而对于使用者，知道了 props、events、slots，就已经能写出上例的使用代码了。</p> <p>到此，Form 和 FormItem 的代码如下：</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token comment">&lt;!-- form.vue --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slot</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'iForm'</span><span class="token punctuation">,</span>
    props<span class="token operator">:</span> <span class="token punctuation">{</span>
      model<span class="token operator">:</span> <span class="token punctuation">{</span>
        type<span class="token operator">:</span> Object
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      rules<span class="token operator">:</span> <span class="token punctuation">{</span>
        type<span class="token operator">:</span> Object
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token comment">&lt;!-- form-item.vue --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>label<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{ label }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slot</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'iFormItem'</span><span class="token punctuation">,</span>
    props<span class="token operator">:</span> <span class="token punctuation">{</span>
      label<span class="token operator">:</span> <span class="token punctuation">{</span>
        type<span class="token operator">:</span> String<span class="token punctuation">,</span>
        <span class="token keyword">default</span><span class="token operator">:</span> <span class="token string">''</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      prop<span class="token operator">:</span> <span class="token punctuation">{</span>
        type<span class="token operator">:</span> String
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h2 id="在-form-中缓存-formitem-实例"><a href="#在-form-中缓存-formitem-实例" class="header-anchor">#</a> 在 Form 中缓存 FormItem 实例</h2> <p><code>Form</code> 组件的核心功能是数据校验，一个 Form 中包含了多个 FormItem，当点击提交按钮时，要逐一对每个 FormItem 内的表单组件校验，而校验是由使用者发起，并通过 <code>Form</code> 来调用每一个 <code>FormItem</code> 的验证方法，再将校验结果汇总后，通过 <code>Form</code> 返回出去。大致的流程如下图所示：</p> <p><img src="https://img1.yixinfinance.com/wiki/images/166c3b7f124cb84a" alt=""></p> <p>因为要在 Form 中逐一调用 FormItem 的验证方法，而 Form 和 FormItem 是独立的，需要预先将 FormItem 的每个实例缓存在 Form 中，这个操作就需要用到第 4 节的组件通信方法。当每个 FormItem 渲染时，将其自身（this）作为参数通过 <code>dispatch</code> 派发到 Form 组件中，然后通过一个数组缓存起来；同理当 FormItem 销毁时，将其从 Form 缓存的数组中移除。相关代码如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// form-item.vue，部分代码省略</span>

<span class="token keyword">import</span> Emitter <span class="token keyword">from</span> <span class="token string">'../../mixins/emitter.js'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">'iFormItem'</span><span class="token punctuation">,</span>
  mixins<span class="token operator">:</span> <span class="token punctuation">[</span> Emitter <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token comment">// 组件渲染时，将实例缓存在 Form 中</span>
  <span class="token function">mounted</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 如果没有传入 prop，则无需校验，也就无需缓存</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>prop<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'iForm'</span><span class="token punctuation">,</span> <span class="token string">'on-form-item-add'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 组件销毁前，将实例从 Form 的缓存中移除</span>
  <span class="token function">beforeDestroy</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'iForm'</span><span class="token punctuation">,</span> <span class="token string">'on-form-item-remove'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>注意，Vue.js 的组件渲染顺序是由内而外的，所以 FormItem 要先于 Form 渲染，在 FormItem 的 mounted 触发时，我们向 Form 派发了事件 <code>on-form-item-add</code>，并将当前 FormItem 的实例（this）传递给了 Form，而此时，Form 的 mounted 尚未触发，因为 Form 在最外层，如果在 Form 的 mounted 里监听事件，是不可以的，所以要在其 created 内监听自定义事件，Form 的 created 要先于 FormItem 的 mounted。所以 Form 的相关代码为：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// form.vue，部分代码省略</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">'iForm'</span><span class="token punctuation">,</span>
  <span class="token function">data</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      fields<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">created</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$on</span><span class="token punctuation">(</span><span class="token string">'on-form-item-add'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">field</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>field<span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span>fields<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>field<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$on</span><span class="token punctuation">(</span><span class="token string">'on-form-item-remove'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">field</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>field<span class="token punctuation">.</span>prop<span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span>fields<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>fields<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>field<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>定义的数据 <code>fields</code> 就是用来缓存所有 FormItem 实例的。</p> <h2 id="触发校验"><a href="#触发校验" class="header-anchor">#</a> 触发校验</h2> <p>Form 支持两种事件来触发校验：</p> <ul><li><strong>blur</strong>：失去焦点时触发，常见的有输入框失去焦点时触发校验；</li> <li><strong>change</strong>：实时输入时触发或选择时触发，常见的有输入框实时输入时触发校验、下拉选择器选择项目时触发校验等。
以上两个事件，都是有具体的表单组件来触发的，我们先来编写一个简单的输入框组件 <code>i-input</code>。在 <code>components</code> 下新建目录 <code>input</code>，并创建文件 <code>input.vue</code>：</li></ul> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token comment">&lt;!-- input.vue --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span>
         <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name">:value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>currentValue<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name">@input</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>handleInput<span class="token punctuation">&quot;</span></span>
         <span class="token attr-name">@blur</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>handleBlur<span class="token punctuation">&quot;</span></span>
         <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">import</span> Emitter <span class="token keyword">from</span> <span class="token string">'../../mixins/emitter.js'</span><span class="token punctuation">;</span>

  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'iInput'</span><span class="token punctuation">,</span>
    mixins<span class="token operator">:</span> <span class="token punctuation">[</span> Emitter <span class="token punctuation">]</span><span class="token punctuation">,</span>
    props<span class="token operator">:</span> <span class="token punctuation">{</span>
      value<span class="token operator">:</span> <span class="token punctuation">{</span>
        type<span class="token operator">:</span> String<span class="token punctuation">,</span>
        <span class="token keyword">default</span><span class="token operator">:</span> <span class="token string">''</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">data</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        currentValue<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>value
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    watch<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token function">value</span> <span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>currentValue <span class="token operator">=</span> val<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    methods<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token function">handleInput</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> value <span class="token operator">=</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>currentValue <span class="token operator">=</span> value<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'iFormItem'</span><span class="token punctuation">,</span> <span class="token string">'on-form-change'</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function">handleBlur</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'iFormItem'</span><span class="token punctuation">,</span> <span class="token string">'on-form-blur'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>currentValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br></div></div><p>Input 组件中，绑定在 <code>&lt;input&gt;</code> 元素上的原生事件 <code>@input</code>，每当输入一个字符，都会调用句柄 <code>handleInput</code>，并通过 <code>dispatch</code> 方法向上级的 FormItem 组件派发自定义事件 <code>on-form-change</code>；同理，绑定的原生事件 <code>@blur</code> 会在 input 失焦时触发，并传递事件 <code>on-form-blur</code>。</p> <p>基础组件有了，接下来要做的，是在 FormItem 中监听来自 Input 组件派发的自定义事件。这里可以在 mounted 中监听，因为你的手速远赶不上组件渲染的速度，不过在 created 中监听也是没任何问题的。相关代码如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// form-item.vue，部分代码省略</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  methods<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">setRules</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$on</span><span class="token punctuation">(</span><span class="token string">'on-form-blur'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>onFieldBlur<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$on</span><span class="token punctuation">(</span><span class="token string">'on-form-change'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>onFieldChange<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">mounted</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>prop<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'iForm'</span><span class="token punctuation">,</span> <span class="token string">'on-form-item-add'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setRules</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>通过调用 <code>setRules</code> 方法，监听表单组件的两个事件，并绑定了句柄函数 <code>onFieldBlur</code> 和 <code>onFieldChange</code>，分别对应 blur 和 change 两种事件类型。当 onFieldBlur 或 onFieldChange 函数触发时，就意味着 FormItem 要对<strong>当前的数据</strong>进行一次校验。当前的数据，指的就是通过表单域 Form 中定义的 props：model，结合当前 FormItem 定义的 props：prop 来确定的数据，可以回顾上文写过的用例。</p> <p>因为 FormItem 中只定义了数据源的某个 key 名称（即属性 prop），要拿到 Form 中 model 里的数据，需要用到第 3 节的通信方法 provide / inject。所以在 Form 中，把整个实例（this）向下提供，并在 FormItem 中注入：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// form.vue，部分代码省略</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">provide</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      form <span class="token operator">:</span> <span class="token keyword">this</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// form-item.vue，部分代码省略</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  inject<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'form'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>准备好这些，接着就是最核心的校验功能了。blur 和 change 事件都会触发校验，它们调用同一个方法，只是参数不同。相关代码如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// form-item.vue，部分代码省略</span>
<span class="token keyword">import</span> AsyncValidator <span class="token keyword">from</span> <span class="token string">'async-validator'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  inject<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'form'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  props<span class="token operator">:</span> <span class="token punctuation">{</span>
    prop<span class="token operator">:</span> <span class="token punctuation">{</span>
      type<span class="token operator">:</span> String
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">data</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      validateState<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>  <span class="token comment">// 校验状态</span>
      validateMessage<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>  <span class="token comment">// 校验不通过时的提示信息</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  computed<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 从 Form 的 model 中动态得到当前表单组件的数据</span>
    <span class="token function">fieldValue</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>form<span class="token punctuation">.</span>model<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>prop<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  methods<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 从 Form 的 rules 属性中，获取当前 FormItem 的校验规则</span>
    <span class="token function">getRules</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> formRules <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>form<span class="token punctuation">.</span>rules<span class="token punctuation">;</span>

      formRules <span class="token operator">=</span> formRules <span class="token operator">?</span> formRules<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>prop<span class="token punctuation">]</span> <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

      <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>formRules <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 只支持 blur 和 change，所以过滤出符合要求的 rule 规则</span>
    <span class="token function">getFilteredRule</span> <span class="token punctuation">(</span><span class="token parameter">trigger</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> rules <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getRules</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> rules<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">rule</span> <span class="token operator">=&gt;</span> <span class="token operator">!</span>rule<span class="token punctuation">.</span>trigger <span class="token operator">||</span> rule<span class="token punctuation">.</span>trigger<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>trigger<span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">/**
     * 校验数据
     * @param trigger 校验类型
     * @param callback 回调函数
     */</span>
    <span class="token function">validate</span><span class="token punctuation">(</span>trigger<span class="token punctuation">,</span> <span class="token function-variable function">callback</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> rules <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getFilteredRule</span><span class="token punctuation">(</span>trigger<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>rules <span class="token operator">||</span> rules<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token comment">// 设置状态为校验中</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>validateState <span class="token operator">=</span> <span class="token string">'validating'</span><span class="token punctuation">;</span>

      <span class="token comment">// 以下为 async-validator 库的调用方法</span>
      <span class="token keyword">let</span> descriptor <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
      descriptor<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>prop<span class="token punctuation">]</span> <span class="token operator">=</span> rules<span class="token punctuation">;</span>

      <span class="token keyword">const</span> validator <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AsyncValidator</span><span class="token punctuation">(</span>descriptor<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">let</span> model <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

      model<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>prop<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>fieldValue<span class="token punctuation">;</span>

      validator<span class="token punctuation">.</span><span class="token function">validate</span><span class="token punctuation">(</span>model<span class="token punctuation">,</span> <span class="token punctuation">{</span> firstFields<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token parameter">errors</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>validateState <span class="token operator">=</span> <span class="token operator">!</span>errors <span class="token operator">?</span> <span class="token string">'success'</span> <span class="token operator">:</span> <span class="token string">'error'</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>validateMessage <span class="token operator">=</span> errors <span class="token operator">?</span> errors<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>message <span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">;</span>

        <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>validateMessage<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">onFieldBlur</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">validate</span><span class="token punctuation">(</span><span class="token string">'blur'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">onFieldChange</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">validate</span><span class="token punctuation">(</span><span class="token string">'change'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br></div></div><p>在 FormItem 的 <code>validate()</code> 方法中，最终做了两件事：</p> <ol><li>设置了当前的校验状态 <code>validateState</code> 和校验不通过提示信息 <code>validateMessage</code>（通过值为空）；</li> <li>将 validateMessage 通过回调 callback 传递给调用者，这里的调用者是 onFieldBlur 和 onFieldChange，它们只传入了第一个参数 <code>trigger</code>，callback 并未传入，因此也不会触发回调，而这个回调主要是给 Form 用的，因为 Form 中可以通过提交按钮一次性校验所有的 FormItem（后文会介绍）这里只是表单组件触发事件时，对当前 FormItem 做校验。</li></ol> <p>除了校验，还可以对当前数据进行重置。重置是指将表单组件的数据还原到最初绑定的值，而不是清空，因此需要预先缓存一份初始值。同时我们将校验信息也显示在模板中，并加一些样式。相关代码如下：</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token comment">&lt;!-- form-item.vue，部分代码省略 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>label<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{ <span class="token punctuation">'</span>i-form-item-label-required<span class="token punctuation">'</span>: isRequired }<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{ label }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slot</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>validateState === <span class="token punctuation">'</span>error<span class="token punctuation">'</span><span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>i-form-item-message<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{ validateMessage }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    props<span class="token operator">:</span> <span class="token punctuation">{</span>
      label<span class="token operator">:</span> <span class="token punctuation">{</span>
        type<span class="token operator">:</span> String<span class="token punctuation">,</span>
        <span class="token keyword">default</span><span class="token operator">:</span> <span class="token string">''</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      prop<span class="token operator">:</span> <span class="token punctuation">{</span>
        type<span class="token operator">:</span> String
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">data</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        isRequired<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>  <span class="token comment">// 是否为必填</span>
        validateState<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>  <span class="token comment">// 校验状态</span>
        validateMessage<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>  <span class="token comment">// 校验不通过时的提示信息</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">mounted</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 如果没有传入 prop，则无需校验，也就无需缓存</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>prop<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'iForm'</span><span class="token punctuation">,</span> <span class="token string">'on-form-item-add'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 设置初始值，以便在重置时恢复默认值</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>initialValue <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>fieldValue<span class="token punctuation">;</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setRules</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    methods<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token function">setRules</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> rules <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getRules</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>rules<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          rules<span class="token punctuation">.</span><span class="token function">every</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">rule</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// 如果当前校验规则中有必填项，则标记出来</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>isRequired <span class="token operator">=</span> rule<span class="token punctuation">.</span>required<span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$on</span><span class="token punctuation">(</span><span class="token string">'on-form-blur'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>onFieldBlur<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$on</span><span class="token punctuation">(</span><span class="token string">'on-form-change'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>onFieldChange<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token comment">// 从 Form 的 rules 属性中，获取当前 FormItem 的校验规则</span>
      <span class="token function">getRules</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> formRules <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>form<span class="token punctuation">.</span>rules<span class="token punctuation">;</span>

        formRules <span class="token operator">=</span> formRules <span class="token operator">?</span> formRules<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>prop<span class="token punctuation">]</span> <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>formRules <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token comment">// 重置数据</span>
      <span class="token function">resetField</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>validateState <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>validateMessage <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span>form<span class="token punctuation">.</span>model<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>prop<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>initialValue<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
  <span class="token selector">.i-form-item-label-required:before</span> <span class="token punctuation">{</span>
    <span class="token property">content</span><span class="token punctuation">:</span> <span class="token string">'*'</span><span class="token punctuation">;</span>
    <span class="token property">color</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token selector">.i-form-item-message</span> <span class="token punctuation">{</span>
    <span class="token property">color</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br></div></div><p>至此，FormItem 代码已经完成，不过它只具有单独校验的功能，也就是说，只能对自己的一个表单组件验证，不能对一个表单域里的所有组件一次性全部校验。而实现全部校验和全部重置的功能，要在 Form 中完成。</p> <p>上文已经介绍到，在 <code>Form</code> 组件中，预先缓存了全部的 FormItem 实例，自然也能在 Form 中调用它们。通过点击提交按钮全部校验，或点击重置按钮全部重置数据，只需要在 Form 中，逐一调用缓存的 FormItem 实例中的 <code>validate</code> 或 <code>resetField</code> 方法。相关代码如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// form.vue，部分代码省略</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">data</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      fields<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  methods<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 公开方法：全部重置数据</span>
    <span class="token function">resetFields</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>fields<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">field</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        field<span class="token punctuation">.</span><span class="token function">resetField</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 公开方法：全部校验数据，支持 Promise</span>
    <span class="token function">validate</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> valid <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>fields<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">field</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          field<span class="token punctuation">.</span><span class="token function">validate</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span> <span class="token parameter">errors</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>errors<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              valid <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">++</span>count <span class="token operator">===</span> <span class="token keyword">this</span><span class="token punctuation">.</span>fields<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token comment">// 全部完成</span>
              <span class="token function">resolve</span><span class="token punctuation">(</span>valid<span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> callback <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">callback</span><span class="token punctuation">(</span>valid<span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><p>虽然说 Vue.js 的 API 只来自 prop、event、slot 这三个部分，但一些场景下，需要通过 <code>ref</code> 来访问这个组件，调用它的一些内置方法，比如上面的 <code>validate</code> 和 <code>resetFields</code> 方法，就需要使用者来主动调用。</p> <p>resetFields 很简单，就是通过循环逐一调用 FormItem 的 resetField 方法来重置数据。validate 稍显复杂，它支持两种使用方法，一种是普通的回调，比如：</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i-form</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>form<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i-form</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>handleSubmit<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>提交<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    methods<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token function">handleSubmit</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>form<span class="token punctuation">.</span><span class="token function">validate</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">valid</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>valid<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            window<span class="token punctuation">.</span><span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'提交成功'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            window<span class="token punctuation">.</span><span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'表单校验失败'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>同时也支持 Promise，例如：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">handleSubmit</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> validate <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>form<span class="token punctuation">.</span><span class="token function">validate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  validate<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">valid</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>valid<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      window<span class="token punctuation">.</span><span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'提交成功'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      window<span class="token punctuation">.</span><span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'表单校验失败'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>在 Form 组件定义的 Promise 中，只调用了 resolve(valid)，没有调用 reject()，因此不能直接使用 <code>.catch()</code> ，不过聪明的你稍作修改，肯定能够支持到！</p> <p>完整的用例如下：</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">&gt;</span></span>具有数据校验功能的表单组件——Form<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i-form</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>form<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>formValidate<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:rules</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ruleValidate<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i-form-item</span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>用户名<span class="token punctuation">&quot;</span></span> <span class="token attr-name">prop</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>name<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i-input</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>formValidate.name<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i-input</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i-form-item</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i-form-item</span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>邮箱<span class="token punctuation">&quot;</span></span> <span class="token attr-name">prop</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mail<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i-input</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>formValidate.mail<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i-input</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i-form-item</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i-form</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>handleSubmit<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>提交<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>handleReset<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>重置<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">import</span> iForm <span class="token keyword">from</span> <span class="token string">'../components/form/form.vue'</span><span class="token punctuation">;</span>
  <span class="token keyword">import</span> iFormItem <span class="token keyword">from</span> <span class="token string">'../components/form/form-item.vue'</span><span class="token punctuation">;</span>
  <span class="token keyword">import</span> iInput <span class="token keyword">from</span> <span class="token string">'../components/input/input.vue'</span><span class="token punctuation">;</span>

  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    components<span class="token operator">:</span> <span class="token punctuation">{</span> iForm<span class="token punctuation">,</span> iFormItem<span class="token punctuation">,</span> iInput <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">data</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        formValidate<span class="token operator">:</span> <span class="token punctuation">{</span>
          name<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
          mail<span class="token operator">:</span> <span class="token string">''</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        ruleValidate<span class="token operator">:</span> <span class="token punctuation">{</span>
          name<span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span> required<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> message<span class="token operator">:</span> <span class="token string">'用户名不能为空'</span><span class="token punctuation">,</span> trigger<span class="token operator">:</span> <span class="token string">'blur'</span> <span class="token punctuation">}</span>
          <span class="token punctuation">]</span><span class="token punctuation">,</span>
          mail<span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span> required<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> message<span class="token operator">:</span> <span class="token string">'邮箱不能为空'</span><span class="token punctuation">,</span> trigger<span class="token operator">:</span> <span class="token string">'blur'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'email'</span><span class="token punctuation">,</span> message<span class="token operator">:</span> <span class="token string">'邮箱格式不正确'</span><span class="token punctuation">,</span> trigger<span class="token operator">:</span> <span class="token string">'blur'</span> <span class="token punctuation">}</span>
          <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    methods<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token function">handleSubmit</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>form<span class="token punctuation">.</span><span class="token function">validate</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">valid</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>valid<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            window<span class="token punctuation">.</span><span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'提交成功'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            window<span class="token punctuation">.</span><span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'表单校验失败'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function">handleReset</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>form<span class="token punctuation">.</span><span class="token function">resetFields</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br></div></div><p>运行效果：
<img src="https://img1.yixinfinance.com/wiki/images/166c3b8a77e382ec" alt=""></p> <p>完整的示例源码可通过 GitHub 查看：</p> <p><a href="https://github.com/icarusion/vue-component-book" target="_blank" rel="noopener noreferrer">github.com/icarusion/v…<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <blockquote><p>项目基于 Vue CLI 3 构建，下载安装依赖后，通过 npm run serve 可访问。</p></blockquote> <h3 id="结语"><a href="#结语" class="header-anchor">#</a> 结语</h3> <hr> <p>组件最终的效果看起来有点 “low”，但它实现的功能却不简单。通过这个实战，你或许已经感受到本小册一开始说的，组件写到最后，都是在拼 JavaScript 功底。的确，Vue.js 组件为我们提供了一种新的代码组织形式，但归根到底，是离不开 JS 的。</p> <p>这个实战，你应该对独立组件间的通信用法有进一步的认知了吧，不过，这还不是组件通信的终极方案，下一节，我们就来看看适用于任何场景的组件通信方案。</p> <p>注：本节部分代码参考 <a href="https://github.com/iview/iview/tree/2.0/src/components/form" target="_blank" rel="noopener noreferrer">iView<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <h3 id="扩展阅读"><a href="#扩展阅读" class="header-anchor">#</a> 扩展阅读</h3> <hr> <p><a href="https://juejin.im/post/5bdec6e8e51d4505327a8952" target="_blank" rel="noopener noreferrer">一份超级详细的Vue-cli3.0使用教程<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/lutest/brochure/Vue.js组件精讲/04-组件的通信2：派发与广播——自行实现dispatch和broadcast方法.html" class="prev">04-组件的通信2：派发与广播——自行实现dispatch和broadcast方法</a></span> <span class="next"><a href="/lutest/brochure/Vue.js组件精讲/06-组件的通信3：找到任意组件实例——findComponents系列方法.html">06-组件的通信3：找到任意组件实例——findComponents系列方法</a>
      →
    </span></p></div> </main> <span data-v-2ae0ee72></span></div><div class="global-ui"></div></div>
    <script src="/lutest/assets/js/app.ebd1d23d.js" defer></script><script src="/lutest/assets/js/3.6f79f3df.js" defer></script><script src="/lutest/assets/js/4.2436b720.js" defer></script><script src="/lutest/assets/js/53.89d7490c.js" defer></script>
  </body>
</html>
